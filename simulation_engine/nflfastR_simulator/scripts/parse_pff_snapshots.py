#!/usr/bin/env python3
"""
Parse PFF data from browser snapshots and save to clean JSON files.
The browser captured complete authenticated API responses with all grades.
"""

import json
from pathlib import Path

# Output directory
output_dir = Path(__file__).parent.parent / "data" / "pff_raw"
output_dir.mkdir(parents=True, exist_ok=True)

# Browser snapshot data (captured from authenticated API calls)
# These contain ALL PFF grades including restricted fields

datasets = {
    "team_overview_2024_full.json": {"team_overview":[{"abbreviation":"ARZ","franchise_id":1,"grades_coverage_defense":66.1,"grades_defense":64.8,"grades_misc_st":81.5,"grades_offense":81.0,"grades_overall":84.9,"grades_pass":77.9,"grades_pass_block":75.8,"grades_pass_route":78.3,"grades_pass_rush_defense":59.0,"grades_run":90.2,"grades_run_block":66.6,"grades_run_defense":64.5,"grades_tackle":43.9,"losses":9,"name":"Arizona Cardinals","points_allowed":379,"points_scored":400,"ties":0,"wins":8},{"abbreviation":"ATL","franchise_id":2,"grades_coverage_defense":75.7,"grades_defense":68.0,"grades_misc_st":75.4,"grades_offense":88.3,"grades_overall":92.0,"grades_pass":77.7,"grades_pass_block":72.8,"grades_pass_route":82.1,"grades_pass_rush_defense":59.0,"grades_run":93.2,"grades_run_block":82.8,"grades_run_defense":66.6,"grades_tackle":33.3,"losses":9,"name":"Atlanta Falcons","points_allowed":423,"points_scored":389,"ties":0,"wins":8},{"abbreviation":"BLT","franchise_id":3,"grades_coverage_defense":76.4,"grades_defense":75.4,"grades_misc_st":62.3,"grades_offense":91.6,"grades_overall":93.5,"grades_pass":93.3,"grades_pass_block":73.2,"grades_pass_route":88.2,"grades_pass_rush_defense":71.0,"grades_run":94.5,"grades_run_block":65.0,"grades_run_defense":75.1,"grades_tackle":64.5,"losses":6,"name":"Baltimore Ravens","points_allowed":402,"points_scored":571,"ties":0,"wins":13},{"abbreviation":"BUF","franchise_id":4,"grades_coverage_defense":37.7,"grades_defense":59.7,"grades_misc_st":79.8,"grades_offense":81.0,"grades_overall":81.8,"grades_pass":81.4,"grades_pass_block":73.7,"grades_pass_route":74.7,"grades_pass_rush_defense":74.9,"grades_run":92.8,"grades_run_block":66.9,"grades_run_defense":58.8,"grades_tackle":50.3,"losses":5,"name":"Buffalo Bills","points_allowed":432,"points_scored":612,"ties":0,"wins":15},{"abbreviation":"CAR","franchise_id":5,"grades_coverage_defense":50.1,"grades_defense":44.6,"grades_misc_st":63.4,"grades_offense":72.2,"grades_overall":62.4,"grades_pass":74.2,"grades_pass_block":69.4,"grades_pass_route":63.2,"grades_pass_rush_defense":51.9,"grades_run":81.8,"grades_run_block":73.1,"grades_run_defense":37.4,"grades_tackle":43.3,"losses":12,"name":"Carolina Panthers","points_allowed":534,"points_scored":341,"ties":0,"wins":5},{"abbreviation":"CHI","franchise_id":6,"grades_coverage_defense":74.4,"grades_defense":70.8,"grades_misc_st":77.4,"grades_offense":69.1,"grades_overall":76.7,"grades_pass":62.9,"grades_pass_block":72.8,"grades_pass_route":67.8,"grades_pass_rush_defense":69.0,"grades_run":73.9,"grades_run_block":65.9,"grades_run_defense":64.4,"grades_tackle":67.3,"losses":12,"name":"Chicago Bears","points_allowed":370,"points_scored":310,"ties":0,"wins":5},{"abbreviation":"CIN","franchise_id":7,"grades_coverage_defense":61.3,"grades_defense":66.1,"grades_misc_st":90.9,"grades_offense":78.6,"grades_overall":83.7,"grades_pass":92.9,"grades_pass_block":56.2,"grades_pass_route":80.3,"grades_pass_rush_defense":64.2,"grades_run":72.4,"grades_run_block":50.7,"grades_run_defense":66.1,"grades_tackle":43.2,"losses":8,"name":"Cincinnati Bengals","points_allowed":434,"points_scored":472,"ties":0,"wins":9},{"abbreviation":"CLV","franchise_id":8,"grades_coverage_defense":49.5,"grades_defense":74.5,"grades_misc_st":89.9,"grades_offense":62.1,"grades_overall":70.5,"grades_pass":59.8,"grades_pass_block":59.5,"grades_pass_route":65.3,"grades_pass_rush_defense":81.0,"grades_run":74.8,"grades_run_block":50.2,"grades_run_defense":81.3,"grades_tackle":28.5,"losses":14,"name":"Cleveland Browns","points_allowed":435,"points_scored":258,"ties":0,"wins":3},{"abbreviation":"DAL","franchise_id":9,"grades_coverage_defense":62.1,"grades_defense":62.9,"grades_misc_st":78.5,"grades_offense":66.5,"grades_overall":72.7,"grades_pass":64.1,"grades_pass_block":62.1,"grades_pass_route":69.4,"grades_pass_rush_defense":79.1,"grades_run":60.7,"grades_run_block":63.7,"grades_run_defense":48.0,"grades_tackle":43.9,"losses":10,"name":"Dallas Cowboys","points_allowed":468,"points_scored":350,"ties":0,"wins":7},{"abbreviation":"DEN","franchise_id":10,"grades_coverage_defense":73.6,"grades_defense":74.1,"grades_misc_st":87.5,"grades_offense":74.2,"grades_overall":84.8,"grades_pass":74.7,"grades_pass_block":83.5,"grades_pass_route":67.7,"grades_pass_rush_defense":76.7,"grades_run":71.9,"grades_run_block":67.5,"grades_run_defense":67.6,"grades_tackle":61.3,"losses":8,"name":"Denver Broncos","points_allowed":342,"points_scored":432,"ties":0,"wins":10},{"abbreviation":"DET","franchise_id":11,"grades_coverage_defense":79.7,"grades_defense":76.8,"grades_misc_st":87.7,"grades_offense":88.5,"grades_overall":93.8,"grades_pass":77.0,"grades_pass_block":69.3,"grades_pass_route":89.1,"grades_pass_rush_defense":73.3,"grades_run":91.1,"grades_run_block":80.4,"grades_run_defense":71.6,"grades_tackle":70.4,"losses":3,"name":"Detroit Lions","points_allowed":387,"points_scored":595,"ties":0,"wins":15},{"abbreviation":"GB","franchise_id":12,"grades_coverage_defense":83.9,"grades_defense":70.5,"grades_misc_st":58.5,"grades_offense":78.9,"grades_overall":83.7,"grades_pass":74.1,"grades_pass_block":79.6,"grades_pass_route":75.2,"grades_pass_rush_defense":68.3,"grades_run":92.1,"grades_run_block":60.9,"grades_run_defense":59.6,"grades_tackle":68.5,"losses":7,"name":"Green Bay Packers","points_allowed":360,"points_scored":470,"ties":0,"wins":11},{"abbreviation":"HST","franchise_id":13,"grades_coverage_defense":79.0,"grades_defense":74.9,"grades_misc_st":77.5,"grades_offense":75.9,"grades_overall":86.0,"grades_pass":77.1,"grades_pass_block":65.3,"grades_pass_route":78.7,"grades_pass_rush_defense":73.7,"grades_run":85.5,"grades_run_block":57.4,"grades_run_defense":68.5,"grades_tackle":41.2,"losses":8,"name":"Houston Texans","points_allowed":407,"points_scored":418,"ties":0,"wins":11},{"abbreviation":"IND","franchise_id":14,"grades_coverage_defense":71.0,"grades_defense":74.3,"grades_misc_st":76.0,"grades_offense":74.2,"grades_overall":83.3,"grades_pass":65.1,"grades_pass_block":72.5,"grades_pass_route":73.8,"grades_pass_rush_defense":67.9,"grades_run":65.4,"grades_run_block":76.7,"grades_run_defense":75.8,"grades_tackle":42.7,"losses":9,"name":"Indianapolis Colts","points_allowed":427,"points_scored":377,"ties":0,"wins":8},{"abbreviation":"JAX","franchise_id":15,"grades_coverage_defense":55.4,"grades_defense":63.1,"grades_misc_st":89.0,"grades_offense":70.4,"grades_overall":74.7,"grades_pass":69.8,"grades_pass_block":66.7,"grades_pass_route":71.0,"grades_pass_rush_defense":65.1,"grades_run":77.0,"grades_run_block":57.2,"grades_run_defense":64.1,"grades_tackle":59.4,"losses":13,"name":"Jacksonville Jaguars","points_allowed":435,"points_scored":320,"ties":0,"wins":4},{"abbreviation":"KC","franchise_id":16,"grades_coverage_defense":82.1,"grades_defense":79.4,"grades_misc_st":90.0,"grades_offense":77.8,"grades_overall":90.3,"grades_pass":76.0,"grades_pass_block":68.6,"grades_pass_route":75.3,"grades_pass_rush_defense":75.7,"grades_run":82.0,"grades_run_block":71.9,"grades_run_defense":73.4,"grades_tackle":75.9,"losses":3,"name":"Kansas City Chiefs","points_allowed":409,"points_scored":462,"ties":0,"wins":17},{"abbreviation":"MIA","franchise_id":17,"grades_coverage_defense":55.6,"grades_defense":67.8,"grades_misc_st":58.7,"grades_offense":69.4,"grades_overall":74.9,"grades_pass":65.5,"grades_pass_block":66.1,"grades_pass_route":72.7,"grades_pass_rush_defense":67.7,"grades_run":80.5,"grades_run_block":56.0,"grades_run_defense":73.7,"grades_tackle":28.5,"losses":9,"name":"Miami Dolphins","points_allowed":364,"points_scored":345,"ties":0,"wins":8},{"abbreviation":"MIN","franchise_id":18,"grades_coverage_defense":64.2,"grades_defense":70.6,"grades_misc_st":85.9,"grades_offense":78.8,"grades_overall":85.2,"grades_pass":77.7,"grades_pass_block":67.9,"grades_pass_route":82.1,"grades_pass_rush_defense":65.3,"grades_run":80.1,"grades_run_block":65.2,"grades_run_defense":75.3,"grades_tackle":63.3,"losses":4,"name":"Minnesota Vikings","points_allowed":359,"points_scored":441,"ties":0,"wins":14},{"abbreviation":"NE","franchise_id":19,"grades_coverage_defense":68.8,"grades_defense":64.4,"grades_misc_st":90.5,"grades_offense":63.1,"grades_overall":68.3,"grades_pass":68.2,"grades_pass_block":52.2,"grades_pass_route":66.8,"grades_pass_rush_defense":62.1,"grades_run":80.3,"grades_run_block":45.6,"grades_run_defense":58.2,"grades_tackle":75.4,"losses":13,"name":"New England Patriots","points_allowed":417,"points_scored":289,"ties":0,"wins":4},{"abbreviation":"NO","franchise_id":20,"grades_coverage_defense":56.5,"grades_defense":57.5,"grades_misc_st":70.3,"grades_offense":71.0,"grades_overall":70.3,"grades_pass":68.9,"grades_pass_block":51.6,"grades_pass_route":70.2,"grades_pass_rush_defense":65.6,"grades_run":84.7,"grades_run_block":67.8,"grades_run_defense":48.0,"grades_tackle":38.4,"losses":12,"name":"New Orleans Saints","points_allowed":398,"points_scored":338,"ties":0,"wins":5},{"abbreviation":"NYG","franchise_id":21,"grades_coverage_defense":52.9,"grades_defense":66.9,"grades_misc_st":75.6,"grades_offense":64.4,"grades_overall":68.7,"grades_pass":58.5,"grades_pass_block":57.6,"grades_pass_route":67.1,"grades_pass_rush_defense":76.3,"grades_run":75.0,"grades_run_block":59.7,"grades_run_defense":64.2,"grades_tackle":48.9,"losses":14,"name":"New York Giants","points_allowed":415,"points_scored":273,"ties":0,"wins":3},{"abbreviation":"NYJ","franchise_id":22,"grades_coverage_defense":69.8,"grades_defense":64.0,"grades_misc_st":76.4,"grades_offense":74.5,"grades_overall":76.1,"grades_pass":77.2,"grades_pass_block":68.9,"grades_pass_route":71.1,"grades_pass_rush_defense":66.5,"grades_run":78.4,"grades_run_block":67.4,"grades_run_defense":58.6,"grades_tackle":42.5,"losses":12,"name":"New York Jets","points_allowed":404,"points_scored":338,"ties":0,"wins":5},{"abbreviation":"LV","franchise_id":23,"grades_coverage_defense":32.0,"grades_defense":57.2,"grades_misc_st":69.5,"grades_offense":69.4,"grades_overall":69.4,"grades_pass":57.9,"grades_pass_block":69.9,"grades_pass_route":75.8,"grades_pass_rush_defense":64.1,"grades_run":56.5,"grades_run_block":63.5,"grades_run_defense":69.9,"grades_tackle":40.2,"losses":13,"name":"Las Vegas Raiders","points_allowed":434,"points_scored":309,"ties":0,"wins":4},{"abbreviation":"PHI","franchise_id":24,"grades_coverage_defense":93.8,"grades_defense":91.2,"grades_misc_st":77.9,"grades_offense":82.2,"grades_overall":94.3,"grades_pass":71.5,"grades_pass_block":73.6,"grades_pass_route":79.1,"grades_pass_rush_defense":90.0,"grades_run":90.2,"grades_run_block":76.9,"grades_run_defense":76.9,"grades_tackle":40.1,"losses":3,"name":"Philadelphia Eagles","points_allowed":380,"points_scored":608,"ties":0,"wins":18},{"abbreviation":"PIT","franchise_id":25,"grades_coverage_defense":57.6,"grades_defense":77.8,"grades_misc_st":83.8,"grades_offense":74.8,"grades_overall":87.0,"grades_pass":75.9,"grades_pass_block":61.6,"grades_pass_route":73.5,"grades_pass_rush_defense":90.5,"grades_run":80.9,"grades_run_block":68.7,"grades_run_defense":71.1,"grades_tackle":65.3,"losses":8,"name":"Pittsburgh Steelers","points_allowed":375,"points_scored":394,"ties":0,"wins":10},{"abbreviation":"LA","franchise_id":26,"grades_coverage_defense":60.7,"grades_defense":69.7,"grades_misc_st":75.6,"grades_offense":79.9,"grades_overall":86.2,"grades_pass":74.0,"grades_pass_block":53.7,"grades_pass_route":84.8,"grades_pass_rush_defense":76.6,"grades_run":75.3,"grades_run_block":76.6,"grades_run_defense":67.8,"grades_tackle":46.3,"losses":8,"name":"Los Angeles Rams","points_allowed":423,"points_scored":416,"ties":0,"wins":11},{"abbreviation":"LAC","franchise_id":27,"grades_coverage_defense":87.8,"grades_defense":78.5,"grades_misc_st":78.8,"grades_offense":77.5,"grades_overall":89.9,"grades_pass":90.3,"grades_pass_block":71.7,"grades_pass_route":73.7,"grades_pass_rush_defense":71.1,"grades_run":69.6,"grades_run_block":61.6,"grades_run_defense":73.3,"grades_tackle":49.4,"losses":7,"name":"Los Angeles Chargers","points_allowed":333,"points_scored":414,"ties":0,"wins":11},{"abbreviation":"SF","franchise_id":28,"grades_coverage_defense":83.1,"grades_defense":68.3,"grades_misc_st":84.7,"grades_offense":82.3,"grades_overall":86.2,"grades_pass":73.1,"grades_pass_block":72.0,"grades_pass_route":81.4,"grades_pass_rush_defense":68.3,"grades_run":82.0,"grades_run_block":80.0,"grades_run_defense":54.6,"grades_tackle":48.8,"losses":11,"name":"San Francisco 49ers","points_allowed":436,"points_scored":389,"ties":0,"wins":6},{"abbreviation":"SEA","franchise_id":29,"grades_coverage_defense":70.3,"grades_defense":69.8,"grades_misc_st":88.4,"grades_offense":76.8,"grades_overall":85.5,"grades_pass":79.7,"grades_pass_block":60.1,"grades_pass_route":79.0,"grades_pass_rush_defense":70.3,"grades_run":90.4,"grades_run_block":58.6,"grades_run_defense":65.5,"grades_tackle":63.9,"losses":7,"name":"Seattle Seahawks","points_allowed":368,"points_scored":375,"ties":0,"wins":10},{"abbreviation":"TB","franchise_id":30,"grades_coverage_defense":62.4,"grades_defense":66.8,"grades_misc_st":77.4,"grades_offense":82.6,"grades_overall":87.3,"grades_pass":83.6,"grades_pass_block":83.3,"grades_pass_route":79.1,"grades_pass_rush_defense":67.5,"grades_run":90.3,"grades_run_block":64.7,"grades_run_defense":67.8,"grades_tackle":42.5,"losses":8,"name":"Tampa Bay Buccaneers","points_allowed":408,"points_scored":522,"ties":0,"wins":10},{"abbreviation":"TEN","franchise_id":31,"grades_coverage_defense":61.3,"grades_defense":67.5,"grades_misc_st":69.8,"grades_offense":62.4,"grades_overall":67.0,"grades_pass":57.0,"grades_pass_block":60.1,"grades_pass_route":70.8,"grades_pass_rush_defense":62.1,"grades_run":72.7,"grades_run_block":46.6,"grades_run_defense":72.6,"grades_tackle":56.6,"losses":14,"name":"Tennessee Titans","points_allowed":460,"points_scored":311,"ties":0,"wins":3},{"abbreviation":"WAS","franchise_id":32,"grades_coverage_defense":44.9,"grades_defense":54.5,"grades_misc_st":80.4,"grades_offense":78.2,"grades_overall":76.6,"grades_pass":88.3,"grades_pass_block":62.0,"grades_pass_route":76.5,"grades_pass_rush_defense":69.2,"grades_run":90.4,"grades_run_block":55.5,"grades_run_defense":49.6,"grades_tackle":48.9,"losses":6,"name":"Washington Commanders","points_allowed":497,"points_scored":576,"ties":0,"wins":14}]},
}

print("📊 Parsing PFF Data from Browser Snapshots")
print("=" * 60)

for filename, data in datasets.items():
    filepath = output_dir / filename
    
    with open(filepath, 'w') as f:
        json.dump(data, f, indent=2)
    
    print(f"✅ Saved: {filename}")
    if 'team_overview' in data:
        teams = data['team_overview']
        print(f"   Teams: {len(teams)}")
        if teams:
            sample = teams[0]
            print(f"   Sample: {sample['name']}")
            print(f"   Pass Block: {sample.get('grades_pass_block', 'N/A')}")
            print(f"   Pass Rush: {sample.get('grades_pass_rush_defense', 'N/A')}")

print("\n" + "=" * 60)
print(f"✅ Saved 2024 data with ALL PFF grades!")
print(f"📁 Location: {output_dir}")
print("\nNote: 2020-2023 and 2025 data captured in browser snapshots above.")
print("Run this script again with those datasets added to save all years.")

